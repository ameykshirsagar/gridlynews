!function(e){e.fn.gridlynews=function(r,a,i){var n={limit:10,offset:1,header:!0,titletag:"h4",date:!0,dateformat:"datetime",content:!0,snippet:!0,media:!0,showerror:!0,errormsg:"",key:null,ssl:!1,linktarget:"_self",linkredirect:"",linkcontent:!1,sort:"",sortasc:!0,historical:!1},a=e.extend(n,a)
return this.each(function(n,o){var l=e(o),s=""
if(a.ssl&&(s="s"),null==r)return!1
a.offset>0&&(a.offset-=1),a.limit+=a.offset
var c="http"+s+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(r)
c+="&num="+a.limit,a.historical&&(c+="&scoring=h"),null!=a.key&&(c+="&key="+a.key),c+="&output=json_xml",e.getJSON(c,function(r){if(200==r.responseStatus)t(o,r.responseData,a),e.isFunction(i)&&i.call(this,l)
else{if(a.showerror)if(""!=a.errormsg)var n=a.errormsg
else var n=r.responseDetails
e(o).html('<div class="rssError"><p>'+n+"</p></div>")}})})}
var t=function(t,i,n){var s=i.feed
if(!s)return!1
var c=[],d=0,f="",u="odd"
if(n.media)var h=o(i.xmlString),m=h.getElementsByTagName("item")
for(var g=n.offset;g<s.entries.length;g++){d=g-n.offset,c[d]=[]
var v,p=s.entries[g],M="",w=p.link
switch(n.sort){case"title":M=p.title
break
case"date":M=p.publishedDate}if(c[d].sort=M,p.publishedDate){var k=new Date(p.publishedDate),v=k.toLocaleDateString()+" "+k.toLocaleTimeString()
switch(n.dateformat){case"datetime":break
case"date":v=k.toLocaleDateString()
break
case"time":v=k.toLocaleTimeString()
break
case"timeline":v=l(k)
break
default:v=a(k,n.dateformat)}}if(n.linkredirect&&(w=encodeURIComponent(w)),c[d].html='<div class="item"><'+n.titletag+'><a href="'+n.linkredirect+w+'" title="View this feed at '+s.title+'">'+p.title+"</a></"+n.titletag+">",n.date&&v&&(c[d].html+="<div>"+v+"</div>"),n.content){if(n.snippet&&""!=p.contentSnippet){var D=p.contentSnippet
e("img").css("width:30%;z-index:2;")}else var D=p.content
n.linkcontent&&(D='<a href="'+n.linkredirect+w+'" title="View this feed at '+s.title+'">'+D+"</a>"),c[d].html+="<article>"+D+"</article></div>"}if(n.media&&m.length>0){var y=m[g].getElementsByTagName("enclosure")
if(y.length>0){c[d].html+='<div class="rssMedia"><div>Media files</div><ul>'
for(var b=0;b<y.length;b++){var S=y[b].getAttribute("url"),x=y[b].getAttribute("type"),L=y[b].getAttribute("length")
c[d].html+='<li><a href="'+S+'" title="Download this media">'+S.split("/").pop()+"</a> ("+x+", "+r(L)+")</li>"}c[d].html+="</ul></div>"}}}n.sort&&c.sort(function(e,t){if(n.sortasc)var r=e.sort,a=t.sort
else var r=t.sort,a=e.sort
return"date"==n.sort?new Date(r)-new Date(a):(r=r.toLowerCase(),a=a.toLowerCase(),a>r?-1:r>a?1:0)}),e.each(c,function(e){f+=c[e].html+"</div>",u="odd"==u?"even":"odd"}),f+="</ul></div>",e(t).html(f),e("a",t).attr("target",n.linktarget),e(t).gridalicious({gutter:3,width:500,animate:!0})},r=function(e){var t=["bytes","kb","MB","GB","TB","PB"],r=Math.floor(Math.log(e)/Math.log(1024))
return(e/Math.pow(1024,Math.floor(r))).toFixed(2)+" "+t[r]},a=function(e,t){var r=new Date(e)
return e=t,e=e.replace("dd",i(r.getDate())),e=e.replace("MMMM",n(r.getMonth())),e=e.replace("MM",i(r.getMonth()+1)),e=e.replace("yyyy",r.getFullYear()),e=e.replace("hh",i(r.getHours())),e=e.replace("mm",i(r.getMinutes())),e=e.replace("ss",i(r.getSeconds()))},i=function(e){return e+="",e.length<2&&(e="0"+e),e},n=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
return t[e]},o=function(e){var t,r=navigator.appName
return"Microsoft Internet Explorer"==r?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t},l=function(e){var t=new Date,r=new Date(e),a=Math.round((t.getTime()-r.getTime())/1e3)
if(60>a)return"< 1 min"
if(3600>a)var i=Math.round(a/60)-1,n="min"
else if(86400>a)var i=Math.round(a/3600)-1,n="hour"
else if(604800>a)var i=Math.round(a/86400)-1,n="day"
else var i=Math.round(a/604800)-1,n="week"
return i>1&&(n+="s"),i+" "+n}}(jQuery)
